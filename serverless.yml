service: estcelafindelajournee

provider:
  name: aws
  stage: prod
  environment:
    APP_ENV: 'prod'
    APP_DEBUG: false
    APP_SECRET: ${ssm:/estcelafindelajournee/secret}

plugins:
  - ./vendor/bref/bref
  - serverless-lift

functions:
  api:
    handler: public/index.php
    description: ''
    timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds)
    layers:
      - ${bref:layer.php-82-fpm}
    events:
      - httpApi: '*'

constructs:
  website:
    type: server-side-website
    assets:
      '/bundles/*': public/bundles
      '/build/*': public/build
      '/js/*': public/js
      '/css/*': public/css
      '/favicon.ico': public/favicon.ico
      '/robots.txt': public/robots.txt
    domain: estcelafindelajournee.fr
    certificate: ${ssm:/estcelafindelajournee/certificatearn}

# Exclude files from deployment
package:
  patterns:
    - '!.env'
    - '!node_modules/**'
    - '!public/favicon.ico'
    - '!public/assets/**'
    - '!tests/**'
